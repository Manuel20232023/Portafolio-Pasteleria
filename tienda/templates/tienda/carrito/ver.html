{% extends 'tienda/base_store.html' %}
{% load static %}
{% block title %}Carrito - Sweet Blessing{% endblock %}

{% block content %}
<h2 class="mb-3">Tu carrito</h2>

{% if carrito %}
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Precio</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for pid, item in carrito.items %}
        <tr>
          <!-- Producto -->
          <td class="d-flex align-items-center">
            {% if item.imagen %}
              <img src="{{ item.imagen }}" alt="" width="50" class="me-2 rounded">
            {% endif %}
            <div>
              <div>{{ item.nombre }}</div>
              {% if item.tiene_promo %}
                <span class="badge bg-success mt-1">
                  Promo: {{ item.etiqueta_promo }}
                </span>
              {% endif %}
            </div>
          </td>

          <!-- Precio unitario -->
          <td>${{ item.precio|floatformat:0 }}</td>

          <!-- Cantidad -->
          <td>{{ item.cantidad }}</td>

          <!-- Subtotal con posible descuento -->
          <td>
            {% if item.descuento and item.descuento > 0 %}
              <span class="text-muted text-decoration-line-through d-block">
                ${{ item.subtotal_base|floatformat:0 }}
              </span>
              <strong class="d-block">
                ${{ item.subtotal|floatformat:0 }}
              </strong>
              <small class="text-success">
                (Ahorro: ${{ item.descuento|floatformat:0 }})
              </small>
            {% else %}
              ${{ item.subtotal|floatformat:0 }}
            {% endif %}
          </td>

          <!-- Quitar -->
          <td>
            <a class="btn btn-outline-danger btn-sm"
               href="{% url 'tienda:carrito_eliminar' pid %}">
              Quitar
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>

      <tfoot>
        <tr>
          <th colspan="3" class="text-end">Total:</th>
          <th>${{ total|floatformat:0 }}</th>
          <th></th>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="d-flex justify-content-between mt-3">
    <a class="btn btn-outline-secondary" href="{% url 'tienda:carrito_vaciar' %}">
      Vaciar
    </a>
    <div>
      <a class="btn btn-primary me-2" href="{% url 'tienda:productos' %}">
        Seguir comprando
      </a>
      <a class="btn btn-success" href="{% url 'tienda:checkout' %}">
        Ir a pagar
      </a>
    </div>
  </div>

{% else %}
  <div class="d-flex justify-content-center my-5">
    <div class="card shadow-sm border-0" style="max-width: 420px;">
      <div class="card-body text-center py-5">

        {# Opcional: ilustraci√≥n, si la tienes. Si no existe, se oculta. #}
        <img src="{% static 'tienda/img/empty-cart.png' %}"
             alt="Carrito vac√≠o"
             class="mb-3"
             style="max-width: 140px;"
             onerror="this.style.display='none';">

        <h3 class="mb-2">Tu carrito est√° vac√≠o</h3>
        <p class="text-muted mb-4">
          A√∫n no has agregado ning√∫n producto.<br>
          Explora nuestras tortas, postres y reposter√≠a de vitrina üç∞.
        </p>

        <a class="btn btn-lg btn-primary px-4"
           href="{% url 'tienda:productos' %}">
          Ver productos
        </a>

        <p class="mt-3 mb-0 text-muted small">
          ¬øBuscabas algo en especial? Usa el buscador en la parte superior.
        </p>
      </div>
    </div>
  </div>
{% endif %}

{% endblock %}
